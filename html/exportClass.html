<!DOCTYPE html>
<html>
<head>
  <title>Datastage Class Data Export</title>
  <meta charset="UTF-8">
  <style type="text/css">
    body {background-color:#FFF8E8;}
    H1 { text-align: center }
  </style>
  <script type="text/javascript">

    function startProgressStream() {
      var xmlHttp = null;
      var courseID   = document.getElementById("courseID").value;
      var fileAction = document.getElementById("fileAction").checked;
      var theURL     = "http://mono.stanford.edu/code/exportClass.py";

      console.log("StartProgressStream() called.") //*******

      theURL += "?courseID="+courseID+"&fileAction="+fileAction;

      if(typeof(EventSource)!=="undefined") {
        var source=new EventSource(theURL);
        source.onmessage=function(event) {
          console.log("Event caught.") //*******
          document.getElementById("progress").innerHTML+=event.data + "<br>";
        }
      }
      else {
        document.getElementById("progress").innerHTML="Browser does not support server-sent events...";
      }
   }
  </script>

</head>
<body>

  <h1>Export One Class to CSV</h1>

    Course to export (may use MySQL regex): <input type="text"
						   id="courseID">
    <input type="checkbox" id="fileAction" value="xpunge">Remove 
    any previous exports of same class<br>

    <input type="button" value="Export Class" onclick="startProgressStream()">

  <div id="progress"></div>

</body>
</html>
